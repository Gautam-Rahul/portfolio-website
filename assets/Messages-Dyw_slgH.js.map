{"version":3,"file":"Messages-Dyw_slgH.js","sources":["../../src/pages/admin/Messages.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { FaEnvelope, FaEnvelopeOpen, FaTrash, FaCheck, FaTimes } from 'react-icons/fa';\r\nimport Loader from '../../components/Loader';\r\nimport api from '../../utils/api';\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\r\n\r\nconst Messages = () => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [activeMessage, setActiveMessage] = useState(null);\r\n  const [actionLoading, setActionLoading] = useState(false);\r\n  const [deleteConfirm, setDeleteConfirm] = useState(null);\r\n  \r\n  // Fetch messages\r\n  useEffect(() => {\r\n    const fetchMessages = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const { data } = await api.get('/contact');\r\n        \r\n        if (data.success) {\r\n          setMessages(data.contacts);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error fetching messages:', err);\r\n        setError('Failed to load messages. Please try again later.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    \r\n    fetchMessages();\r\n  }, []);\r\n  \r\n  // Handle viewing a message (mark as read)\r\n  const handleViewMessage = async (message) => {\r\n    setActiveMessage(message);\r\n    \r\n    // If message is unread, mark as read\r\n    if (!message.read) {\r\n      try {\r\n        setActionLoading(true);\r\n        \r\n        const response = await api.put(`/contact/${message._id}/read`);\r\n        \r\n        if (response.data.success) {\r\n          // Update message in state\r\n          setMessages(messages.map(msg => \r\n            msg._id === message._id ? { ...msg, read: true } : msg\r\n          ));\r\n          \r\n          // Update active message\r\n          setActiveMessage(prev => ({ ...prev, read: true }));\r\n        }\r\n      } catch (err) {\r\n        console.error('Error marking message as read:', err);\r\n        setError(err.response?.data?.message || 'Failed to mark message as read.');\r\n      } finally {\r\n        setActionLoading(false);\r\n      }\r\n    }\r\n  };\r\n  \r\n  // Handle deleting a message\r\n  const handleDelete = async (messageId) => {\r\n    try {\r\n      setActionLoading(true);\r\n      \r\n      const response = await api.delete(`/contact/${messageId}`);\r\n      \r\n      if (response.data.success) {\r\n        // Remove message from state\r\n        setMessages(prevMessages => prevMessages.filter(msg => msg._id !== messageId));\r\n        \r\n        // If active message is deleted, close it\r\n        if (activeMessage && activeMessage._id === messageId) {\r\n          setActiveMessage(null);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error deleting message:', err);\r\n      setError(err.response?.data?.message || 'Failed to delete message. Please try again.');\r\n    } finally {\r\n      setDeleteConfirm(null);\r\n      setActionLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Format date from ISO string\r\n  const formatDate = (dateString) => {\r\n    const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };\r\n    return new Date(dateString).toLocaleDateString(undefined, options);\r\n  };\r\n  \r\n  if (loading) return <Loader />;\r\n  \r\n  return (\r\n    <div>\r\n      <h1 className=\"text-2xl font-bold mb-2 text-gray-900 dark:text-white\">\r\n        Messages\r\n      </h1>\r\n      <p className=\"text-gray-600 dark:text-gray-400 mb-8\">\r\n        Manage contact form submissions\r\n      </p>\r\n      \r\n      {/* Error Message */}\r\n      {error && (\r\n        <div className=\"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 p-4 rounded-lg mb-6\">\r\n          <p>{error}</p>\r\n        </div>\r\n      )}\r\n      \r\n      {messages.length > 0 ? (\r\n        <div className=\"flex flex-col md:flex-row gap-6\">\r\n          {/* Messages List */}\r\n          <div className=\"w-full md:w-1/3 bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden\">\r\n            <h2 className=\"p-4 border-b border-gray-200 dark:border-gray-700 font-medium text-gray-800 dark:text-gray-200\">\r\n              All Messages ({messages.length})\r\n            </h2>\r\n            \r\n            <div className=\"overflow-y-auto max-h-[600px]\">\r\n              {messages.map((message) => (\r\n                <div \r\n                  key={message._id}\r\n                  onClick={() => handleViewMessage(message)}\r\n                  className={`p-4 border-b border-gray-200 dark:border-gray-700 cursor-pointer transition-colors duration-200 ${\r\n                    activeMessage && activeMessage._id === message._id\r\n                      ? 'bg-blue-50 dark:bg-blue-900/20'\r\n                      : 'hover:bg-gray-50 dark:hover:bg-gray-750'\r\n                  } ${\r\n                    !message.read ? 'bg-blue-50 dark:bg-blue-900/10' : ''\r\n                  }`}\r\n                >\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <div className={`mt-1 ${!message.read ? 'text-blue-500' : 'text-gray-400 dark:text-gray-500'}`}>\r\n                      {!message.read ? <FaEnvelope /> : <FaEnvelopeOpen />}\r\n                    </div>\r\n                    \r\n                    <div className=\"flex-grow min-w-0\">\r\n                      <div className=\"flex justify-between items-start\">\r\n                        <h3 className={`font-medium truncate ${!message.read ? 'text-gray-900 dark:text-white' : 'text-gray-700 dark:text-gray-300'}`}>\r\n                          {message.name}\r\n                        </h3>\r\n                        <span className=\"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap ml-2\">\r\n                          {formatDate(message.createdAt).split(',')[0]}\r\n                        </span>\r\n                      </div>\r\n                      \r\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400 truncate\">\r\n                        {message.email}\r\n                      </p>\r\n                      \r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2\">\r\n                        {message.message}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Message Details */}\r\n          <div className=\"w-full md:w-2/3 bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden\">\r\n            {activeMessage ? (\r\n              <div>\r\n                <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center\">\r\n                  <h2 className=\"text-xl font-medium text-gray-800 dark:text-gray-200\">\r\n                    Message from {activeMessage.name}\r\n                  </h2>\r\n                  \r\n                  <button\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      setDeleteConfirm(activeMessage._id);\r\n                    }}\r\n                    disabled={actionLoading}\r\n                    className=\"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300\"\r\n                    aria-label=\"Delete message\"\r\n                  >\r\n                    <FaTrash />\r\n                  </button>\r\n                </div>\r\n                \r\n                {deleteConfirm === activeMessage._id && (\r\n                  <div className=\"m-4 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg text-sm\">\r\n                    <p className=\"text-red-700 dark:text-red-400 mb-2\">\r\n                      Are you sure you want to delete this message?\r\n                    </p>\r\n                    <div className=\"flex justify-end space-x-2\">\r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          setDeleteConfirm(null);\r\n                        }}\r\n                        className=\"px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600\"\r\n                      >\r\n                        <FaTimes className=\"inline mr-1\" /> Cancel\r\n                      </button>\r\n                      <button\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleDelete(activeMessage._id);\r\n                        }}\r\n                        className=\"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600\"\r\n                        disabled={actionLoading}\r\n                      >\r\n                        <FaCheck className=\"inline mr-1\" /> {actionLoading ? 'Deleting...' : 'Confirm'}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                <div className=\"p-6\">\r\n                  <div className=\"mb-6\">\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-1\">From:</p>\r\n                    <div className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\r\n                      <p className=\"font-medium text-gray-900 dark:text-white\">{activeMessage.name}</p>\r\n                      <p className=\"text-blue-600 dark:text-blue-400\">&lt;{activeMessage.email}&gt;</p>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"mb-6\">\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-1\">Date:</p>\r\n                    <p className=\"text-gray-700 dark:text-gray-300\">{formatDate(activeMessage.createdAt)}</p>\r\n                  </div>\r\n                  \r\n                  <div>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-1\">Message:</p>\r\n                    <div className=\"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg whitespace-pre-wrap text-gray-700 dark:text-gray-300\">\r\n                      {activeMessage.message}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"mt-6\">\r\n                    <a\r\n                      href={`mailto:${activeMessage.email}?subject=Re: Your message on my portfolio website`}\r\n                      className=\"btn btn-primary px-4 py-2 inline-flex items-center gap-2\"\r\n                    >\r\n                      <FaEnvelope /> Reply via Email\r\n                    </a>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"p-6 text-center text-gray-500 dark:text-gray-400\">\r\n                <FaEnvelope className=\"w-12 h-12 mx-auto mb-4 opacity-30\" />\r\n                <p>Select a message to view its contents</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center\">\r\n          <FaEnvelope className=\"w-12 h-12 mx-auto mb-4 text-gray-300 dark:text-gray-600\" />\r\n          <h2 className=\"text-xl font-medium text-gray-800 dark:text-gray-200 mb-2\">No Messages Yet</h2>\r\n          <p className=\"text-gray-600 dark:text-gray-400\">\r\n            There are no messages in your inbox. When visitors submit the contact form, their messages will appear here.\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Messages; "],"names":["Messages","messages","setMessages","useState","loading","setLoading","error","setError","activeMessage","setActiveMessage","actionLoading","setActionLoading","deleteConfirm","setDeleteConfirm","useEffect","data","api","err","handleViewMessage","message","msg","prev","_b","_a","handleDelete","messageId","prevMessages","formatDate","dateString","options","jsx","Loader","jsxs","FaEnvelopeOpen","FaEnvelope","e","FaTrash","FaTimes","FaCheck"],"mappings":"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"}